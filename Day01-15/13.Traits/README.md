# Day 13: Trait (ç‰¹å¾)

## ğŸ“ å­¦ä¹ ç›®æ ‡

- ç†è§£ **Trait** çš„æ ¸å¿ƒæ¦‚å¿µï¼ˆç±»ä¼¼æ¥å£ï¼‰
- æŒæ¡å¦‚ä½• **å®šä¹‰ Trait** å’Œ **å®ç° Trait**
- ç†Ÿç»ƒä½¿ç”¨ **Trait Bounds** (çº¦æŸ) å†™æ³›å‹ä»£ç 
- å½»åº•ç†è§£ **å­¤å„¿è§„åˆ™ (Orphan Rule)**
- äº†è§£ **æ´¾ç”Ÿå®** (`#[derive]`) çš„é­”åŠ›

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼šå®šä¹‰å…±äº«è¡Œä¸º

**Trait (ç‰¹å¾)** å‘Šè¯‰ Rust ç¼–è¯‘å™¨ï¼šæŸç§ç±»å‹å…·æœ‰å“ªäº›åŠŸèƒ½ï¼Œå¯ä»¥ä¸å…¶ä»–ç±»å‹å…±äº«è¿™äº›è¡Œä¸ºã€‚
> **æ¯”å–»**ï¼šä¸ç®¡ä½ æ˜¯çŒ«(`Cat`)è¿˜æ˜¯ç‹—(`Dog`)ï¼Œåªè¦ä½ ä¼šå«(`Speak`)ï¼Œæˆ‘å°±èƒ½æŠŠä½ å½“å® ç‰©å¯¹å¾…ã€‚

```mermaid
classDiagram
    class Speak {
        <<trait>>
        +say_hello()
    }
    class Dog {
        +say_hello() "Woof!"
    }
    class Cat {
        +say_hello() "Meow!"
    }
    Speak <|-- Dog : impl
    Speak <|-- Cat : impl
```

---

## ğŸ—ï¸ å®šä¹‰ä¸å®ç°

### 1. å®šä¹‰ Trait

Trait å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ç­¾åã€‚

```rust
pub trait Summary {
    fn summarize(&self) -> String; // æ²¡æœ‰å¤§æ‹¬å·ï¼Œåªæœ‰åˆ†å·

    // é»˜è®¤å®ç° (Default Implementation)
    fn summarize_author(&self) -> String {
        String::from("(Read more...)")
    }
}
```

### 2. ä¸ºç±»å‹å®ç° Trait (`impl for`)

```rust
pub struct Tweet {
    pub username: String,
    pub content: String,
}

impl Summary for Tweet {
    fn summarize(&self) -> String {
        format!("{}: {}", self.username, self.content)
    }
}
```

---

## ğŸ”— Trait ä½œä¸ºå‚æ•° (Trait Bounds)

æˆ‘ä»¬å¯ä»¥ç¼–å†™å‡½æ•°ï¼Œæ¥å—ä»»ä½•å®ç°äº† `Summary` çš„ç±»å‹ã€‚æœ‰ä¸‰ç§å†™æ³•ï¼š

| å†™æ³• | è¯­æ³• | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- |
| **è¯­æ³•ç³–** | `fn notify(item: &impl Summary)` | ç®€å•ç›´è§‚ï¼Œå‚æ•°å°‘æ—¶æ¨è |
| **æ ‡å‡†å†™æ³•** | `fn notify<T: Summary>(item: &T)` | å½“æœ‰å¤šä¸ªå‚æ•°éœ€åŒä¸€ç±»å‹æ—¶ (`T` vs `impl`) |
| **Where å­å¥** | `fn notify<T>(...) where T: Summary` | çº¦æŸå¤ªé•¿ï¼Œä¸ºäº†å¯è¯»æ€§ |

### ç¤ºä¾‹ï¼šå¤šé‡çº¦æŸ

å¦‚æœæˆ‘è¦æ±‚å‚æ•°æ—¢èƒ½ `Summary` åˆèƒ½ `Display`ï¼š

```rust
// è¯­æ³•ç³–
fn notify(item: &(impl Summary + Display)) { ... }

// Where å­å¥ (æ¸…æ™°)
fn some_function<T, U>(t: &T, u: &U) -> i32
where
    T: Display + Clone,
    U: Clone + Debug,
{ ... }
```

---

## ğŸš« å­¤å„¿è§„åˆ™ (Orphan Rule)

ä¸ºäº†ä¿è¯ä»£ç çš„ä¸€è‡´æ€§å’Œé¿å…å†²çªï¼ŒRust è§„å®šï¼š
**ä½ åªèƒ½ä¸ºç±»å‹å®ç° Traitï¼Œå¦‚æœï¼šTrait æ˜¯æœ¬åœ°å®šä¹‰çš„ï¼Œæˆ–è€… ç±»å‹æ˜¯æœ¬åœ°å®šä¹‰çš„ã€‚**
(ç®€è¨€ä¹‹ï¼š**è¦ä¹ˆ Trait æ˜¯ä½ çš„ï¼Œè¦ä¹ˆ Type æ˜¯ä½ çš„**)

| ç±»å‹ (Type) | ç‰¹å¾ (Trait) | å…è®¸å®ç°? | ä¾‹å­ |
| :--- | :--- | :--- | :--- |
| **æœ¬åœ°** (`Tweet`) | **æœ¬åœ°** (`Summary`) | âœ… Yes | æ­£å¸¸å®ç° |
| **æœ¬åœ°** (`Tweet`) | **å¤–éƒ¨** (`Display`) | âœ… Yes | ç»™è‡ªå·±çš„ç±»å‹åŠ æ‰“å°åŠŸèƒ½ |
| **å¤–éƒ¨** (`Vec`) | **æœ¬åœ°** (`Summary`) | âœ… Yes | ç»™æ ‡å‡†åº“ç±»å‹åŠ è‡ªå·±çš„åŠŸèƒ½ |
| **å¤–éƒ¨** (`Vec`) | **å¤–éƒ¨** (`Display`) | âŒ NO | **ç¦æ­¢ï¼** é˜²æ­¢ç ´åæ ‡å‡†åº“è¡Œä¸º |

> **è§£å†³æ–¹æ³•**ï¼šå¦‚æœä½ éè¦ç»™ `Vec` å®ç° `Display`ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª **Newtype** (å…ƒç»„ç»“æ„ä½“åŒ…è£…å™¨) `struct MyVec(Vec<T>)`ï¼Œç„¶åç»™ `MyVec` å®ç°ã€‚

---

## ğŸ­ è¿”å› impl Trait

å‡½æ•°å¯ä»¥è¿”å›å®ç°äº†æŸä¸ª Trait çš„ç±»å‹ï¼Œè€Œä¸éœ€è¦åœ¨ç­¾åä¸­å†™å‡ºå…·ä½“ç±»å‹ã€‚è¿™åœ¨é—­åŒ…å’Œè¿­ä»£å™¨ä¸­éå¸¸å¸¸ç”¨ã€‚

```rust
fn returns_summarizable() -> impl Summary {
    Tweet {
        username: String::from("horse_ebooks"),
        content: String::from("of course, as you probably already know, people"),
    }
}
```

**é™åˆ¶**ï¼šå‡½æ•°ä½“å†…è¿”å›çš„æ‰€æœ‰å¯èƒ½çš„ä»£ç åˆ†æ”¯ï¼Œå¿…é¡»è¿”å› **åŒä¸€ç§** ç±»å‹ã€‚ä¸èƒ½ `if` è¿”å› `Dog`ï¼Œ`else` è¿”å› `Cat`ã€‚

---

## âš¡ æ´¾ç”Ÿå® (Derive)

å¯¹äºä¸€äº›é€šç”¨çš„æ ‡å‡†åº“ Traitï¼ŒRust ç¼–è¯‘å™¨å¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆå®ç°ä»£ç ã€‚

```rust
#[derive(Debug, Clone, Copy, PartialEq)]
struct Point {
    x: i32,
    y: i32,
}
```

åŠ ä¸Šè¿™è¡Œæ³¨è§£åï¼Œ`Point` å°±è‡ªåŠ¨æ‹¥æœ‰äº†æ‰“å°è°ƒè¯• (`Debug`)ã€å…‹éš† (`Clone`)ã€å€¼æ‹·è´ (`Copy`) å’Œ æ¯”è¾ƒç›¸ç­‰ (`PartialEq`) çš„èƒ½åŠ›ã€‚

---

## ğŸ‹ï¸ ç»ƒä¹ é¢˜

ğŸ‘‰ **[ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ç»ƒä¹ é¢˜](./exercises/README.md)**

1. **å®šä¹‰ Trait**: åˆ›å»ºä¸€ä¸ª `Shape` traitï¼ŒåŒ…å« `area()` æ–¹æ³•ã€‚
2. **å®ç° Trait**: ä¸º `Rectangle` å’Œ `Circle` å®ç° `Shape`ã€‚
3. **æ³›å‹å‡½æ•°**: ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä»»ä½• `Shape` å¹¶æ‰“å°é¢ç§¯ã€‚

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **Orphan Rule**: ç‰¢è®°å­¤å„¿è§„åˆ™ï¼Œä¸è¦è¯•å›¾ç»™ `String` å®ç° `Display`ã€‚
2. **Trait Bounds**: å°½é‡ä½¿ç”¨ `where` å­å¥æ¥ä¿æŒå‡½æ•°ç­¾åæ•´æ´ã€‚
3. **Blanket Implementation**: å¯ä»¥ä¸ºæ‰€æœ‰å®ç°äº† `Trait A` çš„ç±»å‹è‡ªåŠ¨å®ç° `Trait B`ã€‚ä¾‹å¦‚æ ‡å‡†åº“ï¼š`impl<T: Display> ToString for T { ... }` (æ‰€ä»¥ä»»ä½•å®ç°äº† Display çš„éƒ½æœ‰ to_string æ–¹æ³•)ã€‚

---

## â­ï¸ ä¸‹ä¸€æ­¥

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä»£ç å¤ç”¨ (Generic) å’Œè¡Œä¸ºæŠ½è±¡ (Trait)ã€‚
ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ç»“æ„ä½“é‡Œå­˜äº†ä¸€ä¸ªå¼•ç”¨ï¼ŒRust æ€ä¹ˆçŸ¥é“è¿™ä¸ªå¼•ç”¨ä»€ä¹ˆæ—¶å€™æ˜¯æœ‰æ•ˆçš„ï¼Ÿå¦‚æœåŸæ¥çš„æ•°æ®æ­»äº†ï¼Œå¼•ç”¨è¿˜åœ¨æ€ä¹ˆåŠï¼Ÿ
è¿™å°±æ˜¯ Rust æœ€ç‹¬ç‰¹ã€æœ€è®©æ–°æ‰‹å¤´ç§ƒçš„æ¦‚å¿µ â€”â€” **ç”Ÿå‘½å‘¨æœŸ**ã€‚

ä¸‹ä¸€èŠ‚: [Day 14: ç”Ÿå‘½å‘¨æœŸ (Lifetimes)](../14.Lifetimes/README.md)
