# Day 18: Cargo è¿›é˜¶ä¸ Crates.io

## ğŸ“ å­¦ä¹ ç›®æ ‡
- ç†è§£ Cargo çš„ Release Profiles (`dev` vs `release`)ã€‚
- æŒæ¡å¦‚ä½•ç¼–å†™æ–‡æ¡£æ³¨é‡Š (`///`) å¹¶è¿è¡Œæ–‡æ¡£æµ‹è¯•ã€‚
- å­¦ä¼šä½¿ç”¨ Cargo Workspaces ç®¡ç†å¤šä¸ªåŒ…ã€‚
- äº†è§£å¦‚ä½•å‘å¸ƒåŒ…åˆ° Crates.io ä»¥åŠç‰ˆæœ¬ç®¡ç†ã€‚

## ğŸ¯ ä¸ºä»€ä¹ˆè¦å­¦è¿™ä¸ª
Cargo æ˜¯ Rust ç”Ÿæ€ç³»ç»Ÿçš„åŸºçŸ³ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œè¿˜æ˜¯ä¾èµ–ç®¡ç†å™¨ã€æ–‡æ¡£ç”Ÿæˆå™¨å’Œæµ‹è¯•è¿è¡Œå™¨ã€‚æŒæ¡ Cargo çš„é«˜çº§ç”¨æ³•å¯¹äºæ„å»ºå¤§å‹é¡¹ç›®ã€ä¼˜åŒ–æ„å»ºé€Ÿåº¦å’Œå‘å¸ƒé«˜è´¨é‡çš„åº“è‡³å…³é‡è¦ã€‚

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µ

### 1. å‘å¸ƒé…ç½® (Release Profiles)
Cargo æä¾›äº†ä¸¤ç§ä¸»è¦çš„é¢„è®¾é…ç½®ï¼š
*   **dev**: è¿è¡Œ `cargo build` æ—¶ä½¿ç”¨ã€‚é»˜è®¤ `opt-level = 0` (æ— ä¼˜åŒ–)ï¼ŒåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œæ„å»ºé€Ÿåº¦å¿«ã€‚
*   **release**: è¿è¡Œ `cargo build --release` æ—¶ä½¿ç”¨ã€‚é»˜è®¤ `opt-level = 3` (æœ€é«˜ä¼˜åŒ–)ï¼Œå»é™¤éƒ¨åˆ†è°ƒè¯•ä¿¡æ¯ï¼Œè¿è¡Œé€Ÿåº¦å¿«ä½†æ„å»ºæ…¢ã€‚

å¯ä»¥åœ¨ `Cargo.toml` ä¸­è‡ªå®šä¹‰ï¼š
```toml
[profile.dev]
opt-level = 1 # å¼€å‘æ—¶ç¨å¾®ä¼˜åŒ–ä¸€ç‚¹
```

### 2. æ–‡æ¡£æ³¨é‡Š
Rust æ‹¥æœ‰ä¸€æµçš„æ–‡æ¡£æ”¯æŒã€‚ä½¿ç”¨ `///` ç¼–å†™æ–‡æ¡£æ³¨é‡Šï¼Œæ”¯æŒ Markdownã€‚

```rust
/// å°†ç»™å®šçš„æ•°å­—åŠ ä¸€ã€‚
///
/// # Examples
///
/// ```
/// let arg = 5;
/// let answer = my_crate::add_one(arg);
///
/// assert_eq!(6, answer);
/// ```
pub fn add_one(x: i32) -> i32 {
    x + 1
}
```
*   `cargo doc --open`: ç”Ÿæˆå¹¶æ‰“å¼€ HTML æ–‡æ¡£ã€‚
*   ä»£ç å—å†…çš„ä»£ç ä¼šè¢«å½“åšæµ‹è¯•è¿è¡Œ (`cargo test`)ã€‚

### 3. Cargo Workspaces (å·¥ä½œç©ºé—´)
å½“é¡¹ç›®å˜å¾—å¾ˆå¤§æ—¶ï¼Œå¯ä»¥å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ª crateã€‚Workspace å…è®¸è¿™äº› crate å…±äº«åŒä¸€ä¸ª `Cargo.lock` å’Œè¾“å‡ºç›®å½• (`target/`)ã€‚

**ç›®å½•ç»“æ„ç¤ºä¾‹**:
```
my-project/
â”œâ”€â”€ Cargo.toml (Workspace root)
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/lib.rs
â”‚   â””â”€â”€ core/
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â””â”€â”€ src/lib.rs
```

**æ ¹ Cargo.toml**:
```toml
[workspace]
members = [
    "crates/api",
    "crates/core",
]
```

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ¡ä»¶ç¼–è¯‘ (Conditional Compilation)

```rust
fn main() {
    if cfg!(target_os = "linux") {
        println!("Running on Linux!");
    } else {
        println!("Not running on Linux.");
    }
}

#[cfg(test)]
mod tests {
    // åªæœ‰åœ¨ cargo test æ—¶æ‰ç¼–è¯‘æ­¤æ¨¡å—
}
```

## ğŸ‹ï¸ ç»ƒä¹ é¢˜

### ç»ƒä¹  1: ç¼–å†™æ–‡æ¡£æµ‹è¯•
ä¸ºä¸€ä¸ªç®€å•çš„æ•°å­¦å‡½æ•°ç¼–å†™æ–‡æ¡£æ³¨é‡Šï¼ŒåŒ…å« Examples éƒ¨åˆ†ï¼Œç¡®ä¿ä»£ç ç¤ºä¾‹æ˜¯å¯è¿è¡Œçš„æµ‹è¯•ã€‚
[æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ](./exercises/solutions/exercise1_solution.rs)

### ç»ƒä¹  2: æ¡ä»¶ç¼–è¯‘
ç¼–å†™ä»£ç ï¼Œæ ¹æ®æ˜¯å¦å¼€å¯äº†æŸä¸ª Feature (å‡è®¾åä¸º "advanced") æ¥ç¼–è¯‘ä¸åŒçš„å‡½æ•°å®ç°ã€‚
*(æ³¨æ„ï¼šå•æ–‡ä»¶ç»ƒä¹ éš¾ä»¥æ¨¡æ‹Ÿ Cargo.toml feature é…ç½®ï¼Œè¿™é‡Œä½¿ç”¨ `cfg` å±æ€§æ¼”ç¤º)*
[æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ](./exercises/solutions/exercise2_solution.rs)

### ç»ƒä¹  3: Workspace æ¨¡æ‹Ÿ
åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿ Workspace ç»“æ„çš„è¯´æ˜ã€‚è¿™ä¸ä»…æ˜¯ä¸€ä¸ªä»£ç ç»ƒä¹ ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¶æ„è®¾è®¡ç»ƒä¹ ã€‚
[æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ](./exercises/solutions/exercise3_solution.rs)

## ğŸ¤” å¸¸è§é—®é¢˜

### Q1: `Cargo.lock` åº”è¯¥æäº¤åˆ° Git å—ï¼Ÿ
A:
- å¦‚æœæ˜¯ **äºŒè¿›åˆ¶é¡¹ç›® (bin)**ï¼š**åº”è¯¥**æäº¤ï¼Œç¡®ä¿æ‰€æœ‰äººæ„å»ºå‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–ç‰ˆæœ¬ä¸€è‡´ã€‚
- å¦‚æœæ˜¯ **åº“é¡¹ç›® (lib)**ï¼šé€šå¸¸**ä¸**æäº¤ï¼Œè®©åº“çš„ä¾èµ–ç‰ˆæœ¬ç”±ä½¿ç”¨è€…çš„ `Cargo.lock` å†³å®šï¼ˆä½†è¿™æœ‰äº‰è®®ï¼Œç°ä»£è§‚ç‚¹å»ºè®®å°½é‡æäº¤ä»¥ä¿è¯ CI ç¨³å®šæ€§ï¼‰ã€‚

### Q2: ä»€ä¹ˆæ˜¯è¯­ä¹‰åŒ–ç‰ˆæœ¬ (SemVer)ï¼Ÿ
A: æ ¼å¼ä¸º `Major.Minor.Patch` (å¦‚ `1.2.3`)ã€‚
- Major: ä¸å…¼å®¹çš„ API ä¿®æ”¹ã€‚
- Minor: å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢ã€‚
- Patch: å‘åå…¼å®¹çš„ Bug ä¿®å¤ã€‚
Cargo é»˜è®¤é”å®š Major ç‰ˆæœ¬ä¸å˜ï¼ˆå¦‚ `^1.2.3` å…è®¸å‡çº§åˆ° `1.9.9` ä½†ä¸å…è®¸ `2.0.0`ï¼‰ã€‚

## ğŸ”— æ‰©å±•é˜…è¯»
- [The Cargo Book](https://doc.rust-lang.org/cargo/)
- [Rust API Guidelines](https://rust-lang.github.io/api-guidelines/)
